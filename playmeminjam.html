<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Papan Pengurangan</title>
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/dragula/3.7.3/dragula.min.js'></script>  
    <style>
      body {
        font-family: "Comic Sans MS", sans-serif;
      }
 
      .bordered-box {
     
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        
      }
      #satuan1 {
        display: flex;
        flex-wrap: wrap; /* Membuat item turun ke baris baru */
        align-items: start; /* Menyelaraskan stick di bagian atas */
        overflow-y: auto; /* Menambahkan scroll vertical jika tinggi sudah mencapai batas */
        gap: 5px; /* Menambahkan jarak antar-stick */
      }
      
      .stick {
        margin: 2px; /* Jarak antar-stick */
      }
      .drop-area {
        display: flex;
        flex-wrap: wrap; /* Membuat stick turun ke baris baru */
        align-items: start; /* Menyelaraskan stick di bagian atas */
        overflow-y: auto; /* Menambahkan scroll jika tinggi melebihi batas */
        gap: 5px; /* Menambahkan jarak antar-stick */
        min-height: 50px;
        max-height: 200px; /* Kamu bisa menghapus max-height jika ingin height otomatis bertambah tanpa batas */
      }
      body {
        overscroll-behavior: none;
        touch-action: manipulation;
      }
 
      
      

      /* Custom stick style */
    </style>
  </head>
  <body >
  



    <!-- Background Image with Opacity -->
    <div class="flex w-full mt-1" >
      <!-- Area Soal -->
       
      <div
      class="bordered-box bg-orange-300 border-2 border-orange-400 p-2 rounded-lg shadow-lg flex flex-col justify-between  "
    >
      <h1 class="text-xl font-bold text-center">AYO Mencoba!</h1>
    
      <div class="text-center mt-4">
        <div class="text-3xl font-bold" id="question"></div>
      </div>
    
      <!-- Area Tempat Stik -->
      <div class="bordered-box flex flex-col items-center mt-4 border-2 border-orange-200 bg-white mb-0">
        <div class="stick-box mt-4 flex flex-row space-x-4 justify-center" id="stickBox"></div>
        <div class="text-center text-lg font-semibold">Stik</div>
      </div>
    </div>
    
      

      <!-- Tempat Penampung Puluhan & Satuan -->
      <div
        class="bordered-box col-span-2 w-full bg-gray-100 shadow-lg rounded-md border-2 border-orange-400"
      >
        <div class="flex justify-between">
          <h1 class="font-bold text-lg text-left ">Puluhan</h1>
          <h1 class="font-bold text-lg ml-32 ">Satuan</h1>
        </div>

        <div class="grid grid-cols-2 grid-rows-2 gap-2">
  
          <div
            class="w-full bg-white border-2 border-orange-300 text-black text-center rounded-md flex justify-center items-center drop-area"
            id="puluhan">
            <span id="puluhanCount" class="font-bold text-lg" hidden>0</span>
          </div>


                  <div
          class="flex flex-wrap justify-center items-start w-full bg-white border-2 border-orange-300 text-black text-center rounded-md drop-area overflow-y-auto"
          id="satuan1"
          style="min-height: 50px;">
          <span id="satuanCount" class="font-bold text-lg" hidden>0</span>
        </div>




         

        
  
       

       


          <div
          class="flex justify-center items-center w-full  bg-white border-2 border-orange-300 text-black text-center rounded-md drop-area"
          id="puluhan2"
        >
          <span id="puluhanCount2" class="font-bold text-lg" hidden>0</span>
        </div>

        <div
        class="flex justify-center items-center w-full bg-white border-2 border-orange-300 text-black text-center rounded-md drop-area"
        id="satuan2">
        <span id="satuanCount2" class="font-bold text-lg " hidden>0</span>
      </div>


      
        
        

  
      


          <!-- Button for validation -->
          <div class="col-span-2 text-center">
            <div class="top-1/2 text-2xl font-bold text-right">-</div>
            <div class="border-t-4 border-black mb-3"></div>
            <div class="flex justify-center items-center">


              <div class="flex flex-wrap justify-center items-start w-full bg-white border-2 border-orange-300 text-black text-center rounded-md drop-area overflow-y-auto h-auto"
              id="akhirhasil"
              style="min-height: 50px; max-height: 200px;">
           <span id="akhirnilai" class="font-bold text-lg">0</span>
         </div>
         

            <button id="checkAnswer"class=" items-center justify-center flex mr-3">
            <img src="/asset/image/check_17767092.png" alt="" srcset="" width="50px">   
            </button>

                 
            <button id="validateButton"  class=" items-center justify-center flex mr-3">
            <img src="/asset/image/equal_9625441.png" alt="" srcset="" width="50px">
            </button>

              <a href="/playmeminjam.html" class="items-center justify-center flex mr-3">
                <button>
                  <img src="/asset/image/rotate_14874074.png" alt="" width="50px">
                </button>
              </a>

              <a href="/play.html" class="items-center justify-center flex mr-3">
                <button>
                  <img src="/asset/image/left-arrow_16799279.png" alt="" width="50px">
                </button></a>

              <!-- Mengurangi margin-top -->
              <input
                type="text"
                id="answer"
                class="border border-gray-300 p-1 rounded-lg w-24 text-center"
                placeholder="Jawaban" hidden
              />
              <div class="mx-3">
                <span id="hasil" class="font-bold text-lg" hidden></span>
              </div>
            </div>
          </div>

          <!-- <div class="z-10 flex items-center  justify-center">
            <img src="/asset/image/lion_12541334.png" alt="" width="50px">
            <img src="/asset/image/lion_12541334.png" alt="" width="50px" class="scale-x-[-1]">

          </div> -->

        </div>
        
      </div>

    </div>
    
    </div>

    <!-- Custom Alert Modal -->
<div id="customAlert" class="fixed inset-0 flex items-center justify-center z-50 hidden">
  <!-- Background Overlay -->
  <div class="fixed inset-0 bg-gray-800 opacity-50"></div>

  <!-- Modal Content -->
  <div class="bg-white rounded-lg shadow-lg p-6 text-center z-10">
    <h2 id="alertMessage" class="text-lg font-semibold mb-4"></h2>
    <img id="animalImage" class="mx-auto mb-4 w-32 h-32 object-contain" alt="Animal Image">

    <audio id="successSound" hidden>
      <source src="asset/myinstants.mp3" type="audio/mpeg">
      Your browser does not support the audio element.
    </audio>

    <audio id="wrongSound" hidden>
      <source src="asset/audio.mp3" type="audio/mpeg">
      Your browser does not support the audio element.
    </audio>

    <button id="closeAlert" class="bg-blue-500 text-white px-4 py-2 rounded-lg">OK</button>
  </div>
</div>



 

    <script>
        
      function getRandomInt(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }
    
    // Buat soal dengan bilangan acak sesuai aturan
    let minuend = getRandomInt(20, 30); // Minuend antara 20 dan 30
    let minuendTens = Math.floor(minuend / 10);
    let minuendOnes = minuend % 10;
    
    let subtrahendTens = getRandomInt(0, minuendTens - 1); // Puluhan subtrahend lebih kecil dari minuendTens
    
    // Pastikan satuan subtrahend lebih besar dari satuan minuend
    let subtrahendOnes;
    if (minuendOnes < 9) {
        subtrahendOnes = getRandomInt(minuendOnes + 1, 9);
    } else {
        subtrahendOnes = 9; // Jika satuan minuend adalah 9, satuan subtrahend diatur ke 9
    }
    
    // Gabungkan puluhan dan satuan untuk membentuk angka subtrahend
    let subtrahend = subtrahendTens * 10 + subtrahendOnes;
      let correctAnswer = minuend - subtrahend;
      let puluhan1 = minuend.toString().length > 1 ? parseInt(minuend.toString()[0]) : 0;
      let satuan1 = minuend.toString().length > 1 ? parseInt(minuend.toString()[1]) : parseInt(minuend.toString()[0])
      let puluhan2 = 0
      let satuan2 = 0

      document.querySelector("#puluhanCount").innerHTML = puluhan1
      document.querySelector("#satuanCount").innerHTML = satuan1

      // Tampilkan soal dengan format khusus
      document.getElementById("question").innerHTML = `
    <div class="text-center">
        <!-- Bagian Minuend (angka atas) -->
        <div class="text-xl font-bold">${minuend} - ${subtrahend}  =
          
        </div>
                <div class="border-t-4 border-black mt-2"></div>

        
        <!-- Bagian Subtrahend (angka bawah dengan tanda pengurangan) -->
        <div class="relative">
            <!-- Tanda pengurangan (-) -->
           
        </div>
        
        <!-- Garis Bawah -->
    </div>`;

// Fungsi untuk menampilkan stick di elemen dengan ID puluhan
function displayStickPuluhan1() {
    // Buat elemen stick baru
    const newStick = document.createElement('img');
    newStick.classList.add('stick', 'rounded-md', 'cursor-move', 'shadow-md', 'h-14', 'w-4', 'mx-1', "stickPuluhan1");
    newStick.setAttribute('draggable', 'true');
    newStick.setAttribute('data-value', '1');
    newStick.src = '/asset/image/wood_8572882.png';
    newStick.alt = 'Stick';
    newStick.classList.add('object-cover');

    // Tambahkan stick baru ke elemen dengan ID "puluhan" (bukan puluhanCount)
    const puluhanElement = document.getElementById("puluhan");
    puluhanElement.appendChild(newStick);
}

// Panggil fungsi displayStick untuk menampilkan stick pada elemen puluhan
for (let i = 0; i < parseInt(minuend.toString().length > 1 ? minuend.toString()[0] : "0"); i++) {
    displayStickPuluhan1();
}

// Fungsi untuk menampilkan stick di elemen dengan ID satuan
function displayStickSatuan1() {
    // Buat elemen stick baru
    const newStick = document.createElement('img');
    newStick.classList.add('stick', 'rounded-md', 'cursor-move', 'shadow-md', 'h-14', 'w-4', 'mx-1', "stickSatuan1");
    newStick.setAttribute('draggable', 'true');
    newStick.setAttribute('data-value', '1');
    newStick.src = '/asset/image/wood_8572882.png';
    newStick.alt = 'Stick';
    newStick.classList.add('object-cover');

    const satuanElement = document.getElementById("satuan1");
    satuanElement.appendChild(newStick);
}

// Panggil fungsi displayStick untuk menampilkan stick pada elemen satuan
for (let i = 0; i < parseInt(minuend.toString().length > 1 ? minuend.toString()[1] : minuend.toString()[0]); i++) {
  displayStickSatuan1();
}

function displayStickSatuan2() {
    // Buat elemen stick baru
    const newStick = document.createElement('img');
    newStick.classList.add('stick', 'rounded-md', 'cursor-move', 'shadow-md', 'h-14', 'w-4', 'mx-1', "stickSatuan2");
    newStick.setAttribute('draggable', 'true');
    newStick.setAttribute('data-value', '1');
    newStick.src = '/asset/image/wood_8572882.png';
    newStick.alt = 'Stick';
    newStick.classList.add('object-cover');

    const satuanElement = document.getElementById("satuan1");
    satuanElement.appendChild(newStick);
}

// Function to display a stick in the stick box
function displayStickbox() {
  const newStick = document.createElement('img');
  newStick.classList.add('stick', 'rounded-md', 'cursor-move', 'shadow-md', 'h-14', 'w-4', 'mx-1');
  newStick.setAttribute('draggable', 'true');
  newStick.setAttribute('data-value', '1');
  newStick.src = '/asset/image/wood_8572882.png';
  newStick.alt = 'Stick';
  newStick.classList.add('object-cover');

  const stickBox = document.getElementById("stickBox");
  stickBox.appendChild(newStick); 
}

// Function to ensure a minimum of two sticks in the stickBox
function maintainStickCount() {
  const stickBox = document.getElementById("stickBox");
  while (stickBox.children.length < 2) {
    displayStickbox();
  }
}

// Initial display of two sticks
maintainStickCount();


// Function to toggle scroll
function toggleScroll(disable) {
  if (disable) {
    document.body.style.overflow = 'hidden';
    document.documentElement.style.overflow = 'hidden';

  } else {
    document.body.style.overflow = '';
    document.documentElement.style.overflow = '';

  }
}

// Prevent page refresh on mobile devices during drag
function preventPageRefreshOnDrag(enable) {
  if (enable) {
    document.addEventListener('touchmove', preventDefaultTouch, { passive: false });
    document.addEventListener('touchstart', preventDefaultTouch, { passive: false });
  } else {
    document.removeEventListener('touchmove', preventDefaultTouch, { passive: false });
    document.removeEventListener('touchstart', preventDefaultTouch, { passive: false });
  }
}

// Prevent default touch behavior
function preventDefaultTouch(e) {
  e.preventDefault();
}

// Dragula setup for stickBox to akhirhasil
dragula([document.querySelector("#stickBox"), document.querySelector("#akhirhasil")], {
  direction: 'horizontal',
  moves: function(el, container) {
    return container.id === "stickBox";
  }
}).on("drag", function() {
  toggleScroll(true);
  preventPageRefreshOnDrag(true); // Prevent page refresh on drag
}).on("drop", function(el, container) {
  if (container.id === "akhirhasil") {
    const currentValue = parseInt(document.getElementById("akhirnilai").innerText);
    const stickValue = parseInt(el.getAttribute("data-value"));
    document.getElementById("akhirnilai").innerText = currentValue + stickValue;

    maintainStickCount();
  }
  toggleScroll(false);
  preventPageRefreshOnDrag(false); // Allow page refresh after drop
}).on("cancel", function() {
  toggleScroll(false);
  preventPageRefreshOnDrag(false); // Allow page refresh if drag is canceled
});

// Repeat the same setup for other dragula instances
// Dragula setup for puluhan to satuan1 drag-and-drop
dragula([document.querySelector("#puluhan"), document.querySelector("#satuan1")], {
  direction: 'horizontal',
  moves: function(el, container) {
    return container.id === "puluhan";
  },
}).on("drag", function() {
  toggleScroll(true);
  preventPageRefreshOnDrag(true);
}).on("drop", function(el, container) {
  if (container.id === "satuan1" && el.classList.contains("stickPuluhan1")) {
    puluhan1--;
    satuan1 = (parseInt(satuan1) + 10).toString();
    document.querySelector("#puluhanCount").innerHTML = puluhan1;
    document.querySelector("#satuanCount").innerHTML = satuan1;

    for (let i = 1; i < 10; i++) {
      displayStickSatuan1();
    }
  }
  toggleScroll(false);
  preventPageRefreshOnDrag(false);
}).on("cancel", function() {
  toggleScroll(false);
  preventPageRefreshOnDrag(false);
});

// Repeat for other drag-and-drop instances
// Dragula setup for satuan1 to satuan2 drag-and-drop
dragula([document.querySelector("#satuan1"), document.querySelector("#satuan2")], {
  moves: function(el, container) {
    return container.id === "satuan1";
  }
}).on("drag", function() {
  toggleScroll(true);
  preventPageRefreshOnDrag(true);
}).on("drop", function(el) {
  if (el.classList.contains("stickSatuan1")) {
    satuan1--;
    satuan2++;
    document.querySelector("#satuanCount").innerHTML = satuan1;
    document.querySelector("#satuanCount2").innerHTML = satuan2;
  }
  toggleScroll(false);
  preventPageRefreshOnDrag(false);
}).on("cancel", function() {
  toggleScroll(false);
  preventPageRefreshOnDrag(false);
});

// Dragula setup for puluhan to puluhan2 drag-and-drop
dragula([document.querySelector("#puluhan"), document.querySelector("#puluhan2")], {
  direction: 'vertical'
}).on("drag", function() {
  toggleScroll(true);
  preventPageRefreshOnDrag(true);
}).on("drop", function(el, container) {
  if (el.classList.contains("stickPuluhan1") && container.id === "puluhan2") {
    puluhan1--;
    puluhan2++;
    document.querySelector("#puluhanCount").innerHTML = puluhan1;
    document.querySelector("#puluhanCount2").innerHTML = puluhan2;
  }
  toggleScroll(false);
  preventPageRefreshOnDrag(false);
}).on("cancel", function() {
  toggleScroll(false);
  preventPageRefreshOnDrag(false);
});


  document.querySelector("#checkAnswer").addEventListener("click", () => {

    const answer = parseInt(document.getElementById("answer").value);
    const customAlert = document.getElementById("customAlert");
    const alertMessage = document.getElementById("alertMessage");
    const animalImage = document.getElementById("animalImage");
    const replaceconrectanswer = correctAnswer + 1

    if(replaceconrectanswer == parseInt(`${puluhan1}${satuan1}`)){
      console.log(`${puluhan1}${satuan1}`)
      console.log(replaceconrectanswer)
      console.log(correctAnswer)

           alertMessage.textContent = "Selamat Jawaban anda benar..!"; // Pesan untuk jawaban benar
      animalImage.src = "/asset/image/applause_8800644.png"; // Gambar untuk jawaban benar
      successSound.play(); // Putar suara untuk jawaban benar

    }else{
      console.log(`${puluhan1}${satuan1}`)

      console.log(correctAnswer)
      alertMessage.textContent = "Yah Jawaban salah, coba lagi."; // Pesan untuk jawaban salah
      animalImage.src = "/asset/image/cry_17533870.png"; // Gambar untuk jawaban salah
      wrongSound.play();

    }
         // Tampilkan modal
  customAlert.classList.remove("hidden");

  // Menambahkan event listener untuk menutup modal
  document.getElementById("closeAlert").addEventListener("click", function () {
    customAlert.classList.add("hidden"); // Sembunyikan modal saat tombol OK diklik
  });
  })

  document.querySelector("#validateButton").addEventListener("click", () => {
    const hasilElement = document.getElementById("hasil");
    const customAlert = document.getElementById("customAlert");
    const alertMessage = document.getElementById("alertMessage");
    const animalImage = document.getElementById("animalImage");
  
   const stickCount = parseInt(document.getElementById("akhirnilai").textContent);
  
    // Validate if the stick count matches the correct answer
    if (stickCount === correctAnswer) {
      hasilElement.textContent = stickCount;
      alertMessage.textContent = "Selamat Jawaban anda benar..!"; // Message for correct answer
      animalImage.src = "/asset/image/applause_8800644.png"; // Image for correct answer
      successSound.play(); // Putar suara untuk jawaban benar

    } else {
      alertMessage.textContent = "Yah Jawaban salah, coba lagi."; // Message for incorrect answer
      animalImage.src = "/asset/image/cry_17533870.png"; // Image for incorrect answer
      wrongSound.play();

    }
  
    // Show the modal
    customAlert.classList.remove("hidden");
  
    // Add an event listener to close the modal
    document.getElementById("closeAlert").addEventListener("click", function () {
      customAlert.classList.add("hidden"); // Hide the modal when OK is clicked
    });
  });
  

    

</script>

  </body>
</html>